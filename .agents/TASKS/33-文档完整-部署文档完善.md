# ä»»åŠ¡ï¼šéƒ¨ç½²æ–‡æ¡£å®Œå–„

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - ä¸­ä¼˜å…ˆçº§
**ç±»å‹**: æ–‡æ¡£å®Œæ•´
**é¢„ä¼°å·¥æ—¶**: 1 å¤©
**å½±å“èŒƒå›´**: docs/

---

## é—®é¢˜æè¿°

é¡¹ç›®ç¼ºå°‘å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£ï¼Œå¯¼è‡´ï¼š
1. éƒ¨ç½²æµç¨‹ä¸æ¸…æ™°
2. ç¯å¢ƒé…ç½®å®¹æ˜“å‡ºé”™
3. è¿ç»´å›°éš¾

---

## éœ€è¦çš„æ–‡æ¡£

| æ–‡æ¡£ | å†…å®¹ | çŠ¶æ€ |
|------|------|------|
| `docs/deployment/local.md` | æœ¬åœ°å¼€å‘ç¯å¢ƒ | âš ï¸ ç¼ºå¤± |
| `docs/deployment/docker.md` | Docker éƒ¨ç½² | âš ï¸ ç¼ºå¤± |
| `docs/deployment/kubernetes.md` | K8s éƒ¨ç½² | âš ï¸ ç¼ºå¤± |
| `docs/deployment/production.md` | ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å• | âš ï¸ ç¼ºå¤± |

---

## æ–‡æ¡£å†…å®¹

### 1. æœ¬åœ°å¼€å‘ç¯å¢ƒ

```markdown
# æœ¬åœ°å¼€å‘ç¯å¢ƒ

## ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ |
|------|----------|----------|
| Node.js | 18.0.0 | 20.x LTS |
| pnpm | 8.0.0 | æœ€æ–° |
| Python | 3.11 | 3.11.x |
| PostgreSQL | 15 | 15.x |
| Redis | 7 | 7.x |

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/your-org/semibot.git
cd semibot
```

### 2. å®‰è£… Node.js ä¾èµ–

```bash
# å®‰è£… pnpmï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
npm install -g pnpm

# å®‰è£…ä¾èµ–
pnpm install
```

### 3. å®‰è£… Python ä¾èµ–

```bash
cd runtime
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
pip install -r requirements-dev.txt
cd ..
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®
# å¿…é¡»é…ç½®ä»¥ä¸‹å˜é‡ï¼š
# - DATABASE_URL
# - REDIS_URL
# - JWT_SECRET
# - OPENAI_API_KEY æˆ– ANTHROPIC_API_KEY
```

### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“
createdb semibot

# è¿è¡Œè¿ç§»
pnpm db:migrate
```

### 6. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
pnpm dev

# æˆ–åˆ†åˆ«å¯åŠ¨
pnpm --filter @semibot/api dev
pnpm --filter @semibot/web dev
cd runtime && python -m src.main
```

## å¼€å‘ç«¯å£

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| Web | 3000 | å‰ç«¯åº”ç”¨ |
| API | 3001 | åç«¯ API |
| Runtime | 8801 | Python Runtime |
| PostgreSQL | 5432 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |

## å¸¸è§é—®é¢˜

### æ•°æ®åº“è¿æ¥å¤±è´¥

æ£€æŸ¥ PostgreSQL æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š
```bash
pg_isready
```

### Redis è¿æ¥å¤±è´¥

æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š
```bash
redis-cli ping
```
```

### 2. Docker éƒ¨ç½²

```markdown
# Docker éƒ¨ç½²

## å‰ææ¡ä»¶

- Docker >= 20.10
- Docker Compose >= 2.0

## å¿«é€Ÿå¯åŠ¨

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## docker-compose.yml

```yaml
version: '3.8'

services:
  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://api:3001
    depends_on:
      - api

  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    ports:
      - "3001:3001"
    environment:
      - DATABASE_URL=postgresql://semibot:password@db:5432/semibot
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - db
      - redis

  runtime:
    build:
      context: ./runtime
      dockerfile: Dockerfile
    ports:
      - "8801:8801"
    environment:
      - DATABASE_URL=postgresql://semibot:password@db:5432/semibot
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    depends_on:
      - db
      - redis

  db:
    image: pgvector/pgvector:pg15
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=semibot
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=semibot
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

## Dockerfile ç¤ºä¾‹

### API Dockerfile

```dockerfile
# apps/api/Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app
COPY package.json pnpm-lock.yaml ./
COPY packages ./packages
COPY apps/api ./apps/api

RUN npm install -g pnpm
RUN pnpm install --frozen-lockfile
RUN pnpm --filter @semibot/api build

FROM node:20-alpine AS runner

WORKDIR /app
COPY --from=builder /app/apps/api/dist ./dist
COPY --from=builder /app/node_modules ./node_modules

EXPOSE 3001
CMD ["node", "dist/index.js"]
```

### Runtime Dockerfile

```dockerfile
# runtime/Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY src ./src

EXPOSE 8801
CMD ["python", "-m", "src.main"]
```

## ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# æ•°æ®åº“
DATABASE_URL=postgresql://semibot:password@db:5432/semibot

# Redis
REDIS_URL=redis://redis:6379

# è®¤è¯
JWT_SECRET=your-secret-key

# LLM
OPENAI_API_KEY=sk-xxx
# æˆ–
ANTHROPIC_API_KEY=sk-ant-xxx
```

## å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥ API
curl http://localhost:3001/health

# æ£€æŸ¥ Runtime
curl http://localhost:8801/health
```
```

### 3. ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

```markdown
# ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

## éƒ¨ç½²å‰æ£€æŸ¥

### å®‰å…¨

- [ ] æ‰€æœ‰å¯†é’¥ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] JWT_SECRET è¶³å¤Ÿå¤æ‚ï¼ˆ32+ å­—ç¬¦ï¼‰
- [ ] æ•°æ®åº“å¯†ç è¶³å¤Ÿå¤æ‚
- [ ] ç¦ç”¨è°ƒè¯•æ¨¡å¼
- [ ] é…ç½® HTTPS
- [ ] é…ç½® CORS ç™½åå•
- [ ] é…ç½® CSP å¤´

### æ•°æ®åº“

- [ ] è¿è¡Œæ‰€æœ‰è¿ç§»
- [ ] é…ç½®è¿æ¥æ± å¤§å°
- [ ] å¯ç”¨ SSL è¿æ¥
- [ ] é…ç½®å®šæœŸå¤‡ä»½
- [ ] è®¾ç½®åªè¯»å‰¯æœ¬ï¼ˆå¦‚éœ€ï¼‰

### ç¼“å­˜

- [ ] Redis å¯ç”¨æŒä¹…åŒ–
- [ ] é…ç½® Redis å¯†ç 
- [ ] é…ç½® maxmemory ç­–ç•¥

### æ—¥å¿—

- [ ] é…ç½®æ—¥å¿—çº§åˆ«ä¸º info
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®æ—¥å¿—èšåˆï¼ˆå¦‚ ELKï¼‰

### ç›‘æ§

- [ ] é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] é…ç½® APMï¼ˆå¦‚ New Relicã€Datadogï¼‰
- [ ] é…ç½®å‘Šè­¦è§„åˆ™
- [ ] é…ç½® Uptime ç›‘æ§

### æ€§èƒ½

- [ ] å¯ç”¨ gzip å‹ç¼©
- [ ] é…ç½® CDN
- [ ] é…ç½® HTTP ç¼“å­˜å¤´
- [ ] ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•

## ç¯å¢ƒå˜é‡

| å˜é‡ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| `NODE_ENV` | âœ… | è®¾ä¸º `production` |
| `DATABASE_URL` | âœ… | PostgreSQL è¿æ¥å­—ç¬¦ä¸² |
| `REDIS_URL` | âœ… | Redis è¿æ¥å­—ç¬¦ä¸² |
| `JWT_SECRET` | âœ… | JWT ç­¾åå¯†é’¥ |
| `OPENAI_API_KEY` | âš ï¸ | OpenAI API Keyï¼ˆäºŒé€‰ä¸€ï¼‰ |
| `ANTHROPIC_API_KEY` | âš ï¸ | Anthropic API Keyï¼ˆäºŒé€‰ä¸€ï¼‰ |
| `LOG_LEVEL` | âŒ | æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ `info` |
| `CORS_ORIGINS` | âŒ | CORS ç™½åå• |

## æ‰©å®¹å»ºè®®

### æ°´å¹³æ‰©å®¹

- API æœåŠ¡å¯æ°´å¹³æ‰©å®¹ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡
- Runtime æœåŠ¡å¯æ°´å¹³æ‰©å®¹ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡
- æ•°æ®åº“ä½¿ç”¨åªè¯»å‰¯æœ¬åˆ†æ‹…è¯»å‹åŠ›

### å‚ç›´æ‰©å®¹

| æœåŠ¡ | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|----------|----------|
| API | 1 CPU, 1GB RAM | 2 CPU, 2GB RAM |
| Runtime | 2 CPU, 2GB RAM | 4 CPU, 4GB RAM |
| PostgreSQL | 2 CPU, 4GB RAM | 4 CPU, 8GB RAM |
| Redis | 1 CPU, 1GB RAM | 2 CPU, 2GB RAM |

## å›æ»šè®¡åˆ’

1. ä¿ç•™æœ€è¿‘ 3 ä¸ªç‰ˆæœ¬çš„é•œåƒ
2. æ•°æ®åº“è¿ç§»æ”¯æŒå›æ»š
3. é…ç½®å›æ»šè„šæœ¬
4. è®°å½•å›æ»šæ­¥éª¤

## æ•…éšœæ’æŸ¥

### API æ— å“åº”

1. æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š`docker ps`
2. æ£€æŸ¥æ—¥å¿—ï¼š`docker logs api`
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
4. æ£€æŸ¥ Redis è¿æ¥

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. æ£€æŸ¥ DATABASE_URL é…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
3. æ£€æŸ¥è¿æ¥æ•°é™åˆ¶
4. æ£€æŸ¥ SSL é…ç½®

### å†…å­˜ä¸è¶³

1. æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼š`docker stats`
2. å¢åŠ å®¹å™¨å†…å­˜é™åˆ¶
3. ä¼˜åŒ–æŸ¥è¯¢ï¼Œå‡å°‘å†…å­˜å ç”¨
```

---

## ä¿®å¤æ¸…å•

### æ–‡æ¡£åˆ›å»º
- [ ] åˆ›å»º `docs/deployment/` ç›®å½•
- [ ] åˆ›å»º `docs/deployment/local.md`
- [ ] åˆ›å»º `docs/deployment/docker.md`
- [ ] åˆ›å»º `docs/deployment/kubernetes.md`
- [ ] åˆ›å»º `docs/deployment/production.md`

### é…ç½®æ–‡ä»¶
- [ ] å®Œå–„ `docker-compose.yml`
- [ ] åˆ›å»ºå„æœåŠ¡ Dockerfile
- [ ] åˆ›å»º `.env.example`

---

## å®Œæˆæ ‡å‡†

- [ ] éƒ¨ç½²æ–‡æ¡£å®Œæ•´
- [ ] é…ç½®æ–‡ä»¶å¯ç”¨
- [ ] éƒ¨ç½²æ­¥éª¤å¯æ‰§è¡Œ
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡

---

## ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](docs/design/ARCHITECTURE.md)
- [æœ¬åœ°å¼€å‘](docs/development/local.md)
