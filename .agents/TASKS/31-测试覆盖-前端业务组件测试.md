# ä»»åŠ¡ï¼šå‰ç«¯ä¸šåŠ¡ç»„ä»¶æµ‹è¯•

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - ä¸­ä¼˜å…ˆçº§
**ç±»å‹**: æµ‹è¯•è¦†ç›–
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©
**å½±å“èŒƒå›´**: apps/web/components/

---

## é—®é¢˜æè¿°

å‰ç«¯ä¸šåŠ¡ç»„ä»¶ç¼ºå°‘æµ‹è¯•è¦†ç›–ï¼Œæ— æ³•ä¿è¯ï¼š
1. ç»„ä»¶æ¸²æŸ“æ­£ç¡®æ€§
2. çŠ¶æ€ç®¡ç†æ­£ç¡®æ€§
3. äº‹ä»¶å¤„ç†æ­£ç¡®æ€§
4. è¾¹ç•Œæ¡ä»¶å¤„ç†

---

## éœ€è¦æµ‹è¯•çš„ç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ | æµ‹è¯•é‡ç‚¹ |
|------|------|----------|
| `AgentCard` | Agent å¡ç‰‡ | æ•°æ®å±•ç¤ºã€ç‚¹å‡»äº‹ä»¶ |
| `AgentForm` | Agent è¡¨å• | è¡¨å•éªŒè¯ã€æäº¤ |
| `MessageList` | æ¶ˆæ¯åˆ—è¡¨ | æ¶ˆæ¯æ¸²æŸ“ã€æ»šåŠ¨ |
| `MessageInput` | æ¶ˆæ¯è¾“å…¥ | è¾“å…¥éªŒè¯ã€å‘é€ |
| `SessionList` | ä¼šè¯åˆ—è¡¨ | åˆ—è¡¨æ¸²æŸ“ã€é€‰æ‹© |
| `SkillSelector` | Skill é€‰æ‹©å™¨ | å¤šé€‰ã€æœç´¢ |

---

## æµ‹è¯•ç”¨ä¾‹

### 1. AgentCard æµ‹è¯•

```typescript
// apps/web/__tests__/components/AgentCard.test.tsx

import { render, screen, fireEvent } from '@testing-library/react'
import { describe, it, expect, vi } from 'vitest'
import { AgentCard } from '../../components/agents/AgentCard'

describe('AgentCard', () => {
  const mockAgent = {
    id: 'agent-1',
    name: 'Test Agent',
    description: 'A test agent',
    isActive: true,
    createdAt: '2024-01-01T00:00:00Z'
  }

  describe('æ¸²æŸ“', () => {
    it('åº”è¯¥æ¸²æŸ“ Agent åç§°', () => {
      render(<AgentCard agent={mockAgent} />)
      expect(screen.getByText('Test Agent')).toBeInTheDocument()
    })

    it('åº”è¯¥æ¸²æŸ“ Agent æè¿°', () => {
      render(<AgentCard agent={mockAgent} />)
      expect(screen.getByText('A test agent')).toBeInTheDocument()
    })

    it('åº”è¯¥æ˜¾ç¤ºæ¿€æ´»çŠ¶æ€', () => {
      render(<AgentCard agent={mockAgent} />)
      expect(screen.getByText('æ¿€æ´»')).toBeInTheDocument()
    })

    it('åº”è¯¥æ˜¾ç¤ºæœªæ¿€æ´»çŠ¶æ€', () => {
      const inactiveAgent = { ...mockAgent, isActive: false }
      render(<AgentCard agent={inactiveAgent} />)
      expect(screen.getByText('æœªæ¿€æ´»')).toBeInTheDocument()
    })

    it('æ— æè¿°æ—¶åº”è¯¥æ˜¾ç¤ºé»˜è®¤æ–‡æœ¬', () => {
      const noDescAgent = { ...mockAgent, description: undefined }
      render(<AgentCard agent={noDescAgent} />)
      expect(screen.getByText('æš‚æ— æè¿°')).toBeInTheDocument()
    })
  })

  describe('äº¤äº’', () => {
    it('ç‚¹å‡»åº”è¯¥è§¦å‘ onClick', () => {
      const onClick = vi.fn()
      render(<AgentCard agent={mockAgent} onClick={onClick} />)

      fireEvent.click(screen.getByRole('article'))

      expect(onClick).toHaveBeenCalledWith(mockAgent)
    })

    it('ç‚¹å‡»ç¼–è¾‘æŒ‰é’®åº”è¯¥è§¦å‘ onEdit', () => {
      const onEdit = vi.fn()
      render(<AgentCard agent={mockAgent} onEdit={onEdit} />)

      fireEvent.click(screen.getByRole('button', { name: /ç¼–è¾‘/i }))

      expect(onEdit).toHaveBeenCalledWith(mockAgent)
    })

    it('ç‚¹å‡»åˆ é™¤æŒ‰é’®åº”è¯¥è§¦å‘ onDelete', () => {
      const onDelete = vi.fn()
      render(<AgentCard agent={mockAgent} onDelete={onDelete} />)

      fireEvent.click(screen.getByRole('button', { name: /åˆ é™¤/i }))

      expect(onDelete).toHaveBeenCalledWith(mockAgent.id)
    })
  })

  describe('æ ·å¼', () => {
    it('é€‰ä¸­çŠ¶æ€åº”è¯¥æœ‰ç‰¹æ®Šæ ·å¼', () => {
      render(<AgentCard agent={mockAgent} selected />)

      const card = screen.getByRole('article')
      expect(card).toHaveClass('border-primary')
    })
  })
})
```

### 2. AgentForm æµ‹è¯•

```typescript
// apps/web/__tests__/components/AgentForm.test.tsx

import { render, screen, waitFor } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { describe, it, expect, vi } from 'vitest'
import { AgentForm } from '../../components/agents/AgentForm'

describe('AgentForm', () => {
  const mockOnSubmit = vi.fn()

  beforeEach(() => {
    mockOnSubmit.mockClear()
  })

  describe('æ¸²æŸ“', () => {
    it('åº”è¯¥æ¸²æŸ“æ‰€æœ‰è¡¨å•å­—æ®µ', () => {
      render(<AgentForm onSubmit={mockOnSubmit} />)

      expect(screen.getByLabelText(/åç§°/i)).toBeInTheDocument()
      expect(screen.getByLabelText(/æè¿°/i)).toBeInTheDocument()
      expect(screen.getByLabelText(/ç³»ç»Ÿæç¤ºè¯/i)).toBeInTheDocument()
    })

    it('ç¼–è¾‘æ¨¡å¼åº”è¯¥å¡«å……åˆå§‹å€¼', () => {
      const initialData = {
        name: 'Existing Agent',
        description: 'Description'
      }

      render(<AgentForm onSubmit={mockOnSubmit} initialData={initialData} />)

      expect(screen.getByLabelText(/åç§°/i)).toHaveValue('Existing Agent')
      expect(screen.getByLabelText(/æè¿°/i)).toHaveValue('Description')
    })
  })

  describe('éªŒè¯', () => {
    it('åç§°ä¸ºç©ºåº”è¯¥æ˜¾ç¤ºé”™è¯¯', async () => {
      render(<AgentForm onSubmit={mockOnSubmit} />)

      await userEvent.click(screen.getByRole('button', { name: /æäº¤/i }))

      await waitFor(() => {
        expect(screen.getByText(/åç§°ä¸èƒ½ä¸ºç©º/i)).toBeInTheDocument()
      })
      expect(mockOnSubmit).not.toHaveBeenCalled()
    })

    it('åç§°è¿‡é•¿åº”è¯¥æ˜¾ç¤ºé”™è¯¯', async () => {
      render(<AgentForm onSubmit={mockOnSubmit} />)

      const nameInput = screen.getByLabelText(/åç§°/i)
      await userEvent.type(nameInput, 'a'.repeat(101))
      await userEvent.click(screen.getByRole('button', { name: /æäº¤/i }))

      await waitFor(() => {
        expect(screen.getByText(/åç§°ä¸èƒ½è¶…è¿‡ 100 ä¸ªå­—ç¬¦/i)).toBeInTheDocument()
      })
    })
  })

  describe('æäº¤', () => {
    it('æœ‰æ•ˆæ•°æ®åº”è¯¥è§¦å‘ onSubmit', async () => {
      render(<AgentForm onSubmit={mockOnSubmit} />)

      await userEvent.type(screen.getByLabelText(/åç§°/i), 'New Agent')
      await userEvent.type(screen.getByLabelText(/æè¿°/i), 'Description')
      await userEvent.click(screen.getByRole('button', { name: /æäº¤/i }))

      await waitFor(() => {
        expect(mockOnSubmit).toHaveBeenCalledWith({
          name: 'New Agent',
          description: 'Description',
          systemPrompt: ''
        })
      })
    })

    it('æäº¤ä¸­åº”è¯¥ç¦ç”¨æŒ‰é’®', async () => {
      mockOnSubmit.mockImplementation(() => new Promise(() => {}))

      render(<AgentForm onSubmit={mockOnSubmit} />)

      await userEvent.type(screen.getByLabelText(/åç§°/i), 'New Agent')
      await userEvent.click(screen.getByRole('button', { name: /æäº¤/i }))

      await waitFor(() => {
        expect(screen.getByRole('button', { name: /æäº¤ä¸­/i })).toBeDisabled()
      })
    })
  })
})
```

### 3. MessageList æµ‹è¯•

```typescript
// apps/web/__tests__/components/MessageList.test.tsx

import { render, screen } from '@testing-library/react'
import { describe, it, expect, vi } from 'vitest'
import { MessageList } from '../../components/chat/MessageList'

describe('MessageList', () => {
  const mockMessages = [
    { id: '1', role: 'user', content: 'Hello', createdAt: '2024-01-01T00:00:00Z' },
    { id: '2', role: 'assistant', content: 'Hi there!', createdAt: '2024-01-01T00:00:01Z' }
  ]

  describe('æ¸²æŸ“', () => {
    it('åº”è¯¥æ¸²æŸ“æ‰€æœ‰æ¶ˆæ¯', () => {
      render(<MessageList messages={mockMessages} />)

      expect(screen.getByText('Hello')).toBeInTheDocument()
      expect(screen.getByText('Hi there!')).toBeInTheDocument()
    })

    it('ç©ºæ¶ˆæ¯åº”è¯¥æ˜¾ç¤ºç©ºçŠ¶æ€', () => {
      render(<MessageList messages={[]} />)

      expect(screen.getByText(/æš‚æ— æ¶ˆæ¯/i)).toBeInTheDocument()
    })

    it('ç”¨æˆ·æ¶ˆæ¯å’ŒåŠ©æ‰‹æ¶ˆæ¯æ ·å¼ä¸åŒ', () => {
      render(<MessageList messages={mockMessages} />)

      const userMessage = screen.getByText('Hello').closest('[data-role]')
      const assistantMessage = screen.getByText('Hi there!').closest('[data-role]')

      expect(userMessage).toHaveAttribute('data-role', 'user')
      expect(assistantMessage).toHaveAttribute('data-role', 'assistant')
    })
  })

  describe('Markdown æ¸²æŸ“', () => {
    it('åº”è¯¥æ¸²æŸ“ Markdown å†…å®¹', () => {
      const mdMessages = [
        { id: '1', role: 'assistant', content: '**Bold** and *italic*', createdAt: '2024-01-01' }
      ]

      render(<MessageList messages={mdMessages} />)

      expect(screen.getByText('Bold')).toHaveStyle({ fontWeight: 'bold' })
    })

    it('åº”è¯¥æ¸²æŸ“ä»£ç å—', () => {
      const codeMessages = [
        { id: '1', role: 'assistant', content: '```js\nconsole.log("hi")\n```', createdAt: '2024-01-01' }
      ]

      render(<MessageList messages={codeMessages} />)

      expect(screen.getByText(/console.log/)).toBeInTheDocument()
    })
  })

  describe('åŠ è½½çŠ¶æ€', () => {
    it('åŠ è½½ä¸­åº”è¯¥æ˜¾ç¤ºéª¨æ¶å±', () => {
      render(<MessageList messages={[]} loading />)

      expect(screen.getByTestId('message-skeleton')).toBeInTheDocument()
    })
  })
})
```

### 4. MessageInput æµ‹è¯•

```typescript
// apps/web/__tests__/components/MessageInput.test.tsx

import { render, screen, fireEvent } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { describe, it, expect, vi } from 'vitest'
import { MessageInput } from '../../components/chat/MessageInput'

describe('MessageInput', () => {
  const mockOnSend = vi.fn()

  beforeEach(() => {
    mockOnSend.mockClear()
  })

  describe('æ¸²æŸ“', () => {
    it('åº”è¯¥æ¸²æŸ“è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®', () => {
      render(<MessageInput onSend={mockOnSend} />)

      expect(screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)).toBeInTheDocument()
      expect(screen.getByRole('button', { name: /å‘é€/i })).toBeInTheDocument()
    })
  })

  describe('è¾“å…¥', () => {
    it('åº”è¯¥èƒ½è¾“å…¥æ–‡æœ¬', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)
      await userEvent.type(input, 'Hello World')

      expect(input).toHaveValue('Hello World')
    })

    it('æŒ‰ Enter åº”è¯¥å‘é€æ¶ˆæ¯', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)
      await userEvent.type(input, 'Hello{enter}')

      expect(mockOnSend).toHaveBeenCalledWith('Hello')
    })

    it('Shift+Enter ä¸åº”è¯¥å‘é€æ¶ˆæ¯', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)
      await userEvent.type(input, 'Hello')
      fireEvent.keyDown(input, { key: 'Enter', shiftKey: true })

      expect(mockOnSend).not.toHaveBeenCalled()
    })
  })

  describe('å‘é€', () => {
    it('ç‚¹å‡»å‘é€æŒ‰é’®åº”è¯¥å‘é€æ¶ˆæ¯', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      await userEvent.type(screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i), 'Hello')
      await userEvent.click(screen.getByRole('button', { name: /å‘é€/i }))

      expect(mockOnSend).toHaveBeenCalledWith('Hello')
    })

    it('å‘é€ååº”è¯¥æ¸…ç©ºè¾“å…¥æ¡†', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)
      await userEvent.type(input, 'Hello')
      await userEvent.click(screen.getByRole('button', { name: /å‘é€/i }))

      expect(input).toHaveValue('')
    })

    it('ç©ºå†…å®¹ä¸åº”è¯¥å‘é€', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      await userEvent.click(screen.getByRole('button', { name: /å‘é€/i }))

      expect(mockOnSend).not.toHaveBeenCalled()
    })

    it('åªæœ‰ç©ºæ ¼ä¸åº”è¯¥å‘é€', async () => {
      render(<MessageInput onSend={mockOnSend} />)

      await userEvent.type(screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i), '   ')
      await userEvent.click(screen.getByRole('button', { name: /å‘é€/i }))

      expect(mockOnSend).not.toHaveBeenCalled()
    })
  })

  describe('ç¦ç”¨çŠ¶æ€', () => {
    it('disabled æ—¶ä¸èƒ½è¾“å…¥', () => {
      render(<MessageInput onSend={mockOnSend} disabled />)

      const input = screen.getByPlaceholderText(/è¾“å…¥æ¶ˆæ¯/i)
      expect(input).toBeDisabled()
    })

    it('disabled æ—¶å‘é€æŒ‰é’®ç¦ç”¨', () => {
      render(<MessageInput onSend={mockOnSend} disabled />)

      expect(screen.getByRole('button', { name: /å‘é€/i })).toBeDisabled()
    })
  })
})
```

---

## æµ‹è¯•ç›®å½•ç»“æ„

```
apps/web/__tests__/components/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ AgentCard.test.tsx
â”‚   â”œâ”€â”€ AgentForm.test.tsx
â”‚   â””â”€â”€ AgentList.test.tsx
â”œâ”€â”€ chat/
â”‚   â”œâ”€â”€ MessageList.test.tsx
â”‚   â”œâ”€â”€ MessageInput.test.tsx
â”‚   â””â”€â”€ MessageItem.test.tsx
â”œâ”€â”€ sessions/
â”‚   â”œâ”€â”€ SessionList.test.tsx
â”‚   â””â”€â”€ SessionItem.test.tsx
â”œâ”€â”€ skills/
â”‚   â”œâ”€â”€ SkillSelector.test.tsx
â”‚   â””â”€â”€ SkillCard.test.tsx
â””â”€â”€ common/
    â”œâ”€â”€ Button.test.tsx
    â”œâ”€â”€ Input.test.tsx
    â””â”€â”€ Modal.test.tsx
```

---

## ä¿®å¤æ¸…å•

### Agent ç»„ä»¶
- [ ] `AgentCard.test.tsx`
- [ ] `AgentForm.test.tsx`
- [ ] `AgentList.test.tsx`

### Chat ç»„ä»¶
- [ ] `MessageList.test.tsx`
- [ ] `MessageInput.test.tsx`
- [ ] `MessageItem.test.tsx`

### Session ç»„ä»¶
- [ ] `SessionList.test.tsx`
- [ ] `SessionItem.test.tsx`

### Skill ç»„ä»¶
- [ ] `SkillSelector.test.tsx`
- [ ] `SkillCard.test.tsx`

---

## å®Œæˆæ ‡å‡†

- [ ] æ‰€æœ‰ä¸šåŠ¡ç»„ä»¶æœ‰æµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡ >= 70%
- [ ] äº¤äº’æµ‹è¯•å®Œæ•´
- [ ] CI é›†æˆé€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡

---

## ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•è§„èŒƒ](docs/design/TESTING.md)
- [ç»„ä»¶å¼€å‘è§„èŒƒ](docs/design/COMPONENTS.md)
