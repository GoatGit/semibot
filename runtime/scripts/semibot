#!/usr/bin/env bash
set -euo pipefail

# Resolve symlinks so this launcher works from ~/.local/bin/semibot links.
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  SOURCE_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ "$SOURCE" != /* ]] && SOURCE="$SOURCE_DIR/$SOURCE"
done

SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"
VENV_PY="$ROOT_DIR/.venv/bin/python"

if [ -x "$VENV_PY" ]; then
  if "$VENV_PY" -c "import uvicorn" >/dev/null 2>&1; then
    exec "$VENV_PY" "$ROOT_DIR/main.py" "$@"
  fi
fi

exec python3 "$ROOT_DIR/main.py" "$@"
