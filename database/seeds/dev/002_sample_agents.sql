-- ============================================================================
-- 002_sample_agents.sql
-- 开发环境示例 Agent 和 Skill 数据
-- ============================================================================

-- 注意：此脚本仅用于开发环境，切勿在生产环境执行
-- 依赖：需要先执行 001_sample_org.sql

-- ----------------------------------------------------------------------------
-- 1. 创建系统内置技能（org_id 为 NULL）
-- ----------------------------------------------------------------------------
INSERT INTO skills (id, org_id, name, description, trigger_keywords, tools, config, is_builtin, created_by) VALUES
(
    'skill-0001-0001-0001-000000000001',
    NULL,  -- 系统内置
    'web_search',
    '网络搜索技能，可以搜索互联网获取最新信息',
    ARRAY['搜索', '查找', '查询', 'search', 'find', 'lookup'],
    '[
        {
            "tool_id": "tool-0001-0001-0001-000000000001",
            "required": true,
            "default_params": {"limit": 10}
        }
    ]',
    '{"max_results": 20, "safe_search": true}',
    true,
    NULL
),
(
    'skill-0001-0001-0001-000000000002',
    NULL,
    'code_execution',
    '代码执行技能，可以运行 Python 代码进行计算和数据处理',
    ARRAY['执行代码', '运行', '计算', 'execute', 'run', 'calculate'],
    '[
        {
            "tool_id": "tool-0001-0001-0001-000000000002",
            "required": true,
            "default_params": {"timeout": 30}
        }
    ]',
    '{"allowed_languages": ["python"], "max_execution_time": 60}',
    true,
    NULL
),
(
    'skill-0001-0001-0001-000000000003',
    NULL,
    'file_operations',
    '文件操作技能，可以读取、写入和管理文件',
    ARRAY['读取文件', '写入文件', '文件', 'read file', 'write file', 'file'],
    '[
        {
            "tool_id": "tool-0001-0001-0001-000000000003",
            "required": true
        }
    ]',
    '{"allowed_extensions": ["txt", "json", "csv", "md"], "max_file_size_mb": 10}',
    true,
    NULL
);

-- ----------------------------------------------------------------------------
-- 2. 创建组织自定义技能
-- ----------------------------------------------------------------------------
INSERT INTO skills (id, org_id, name, description, trigger_keywords, tools, config, is_builtin, created_by) VALUES
(
    'skill-1111-1111-1111-111111111111',
    '11111111-1111-1111-1111-111111111111',
    'data_analysis',
    '数据分析技能，可以分析数据并生成可视化报告',
    ARRAY['分析', '数据分析', '统计', 'analyze', 'data analysis'],
    '[
        {
            "tool_id": "tool-0001-0001-0001-000000000002",
            "required": true
        }
    ]',
    '{"output_formats": ["json", "csv", "chart"]}',
    false,
    '22222222-2222-2222-2222-222222222222'
),
(
    'skill-1111-1111-1111-222222222222',
    '11111111-1111-1111-1111-111111111111',
    'document_qa',
    '文档问答技能，可以基于上传的文档回答问题',
    ARRAY['文档', '问答', 'document', 'qa', '阅读'],
    '[]',
    '{"use_memory": true, "context_window": 4096}',
    false,
    '22222222-2222-2222-2222-222222222222'
);

-- ----------------------------------------------------------------------------
-- 3. 创建示例 Agents
-- ----------------------------------------------------------------------------
INSERT INTO agents (id, org_id, name, description, system_prompt, config, skills, sub_agents, version, is_public) VALUES
-- 通用助手 Agent
(
    'agent-1111-1111-1111-111111111111',
    '11111111-1111-1111-1111-111111111111',
    'General Assistant',
    '通用智能助手，可以回答问题、搜索信息、执行代码等',
    '你是一个智能助手，名为 Semibot。你的任务是帮助用户解决各种问题。

## 能力
- 回答问题和提供信息
- 搜索互联网获取最新资讯
- 执行代码进行计算和数据处理
- 分析文档和数据

## 行为准则
- 始终保持友好和专业
- 如果不确定，诚实地说明
- 优先使用工具获取准确信息
- 保护用户隐私和数据安全',
    '{
        "model": "gpt-4o",
        "temperature": 0.7,
        "max_tokens": 4096,
        "timeout_seconds": 120,
        "retry_attempts": 3
    }',
    ARRAY['skill-0001-0001-0001-000000000001', 'skill-0001-0001-0001-000000000002'],
    ARRAY[]::TEXT[],
    1,
    false
),
-- 代码助手 Agent
(
    'agent-1111-1111-1111-222222222222',
    '11111111-1111-1111-1111-111111111111',
    'Code Assistant',
    '专业编程助手，擅长代码编写、调试和优化',
    '你是一个专业的编程助手。你的专长是帮助用户编写、调试和优化代码。

## 专业领域
- Python, JavaScript, TypeScript
- 数据结构与算法
- Web 开发（前端和后端）
- 数据库和 SQL

## 编码规范
- 编写清晰、可读的代码
- 添加必要的注释
- 遵循最佳实践和设计模式
- 考虑性能和安全性',
    '{
        "model": "gpt-4o",
        "temperature": 0.3,
        "max_tokens": 8192,
        "timeout_seconds": 180,
        "retry_attempts": 3
    }',
    ARRAY['skill-0001-0001-0001-000000000002', 'skill-0001-0001-0001-000000000003'],
    ARRAY[]::TEXT[],
    1,
    false
),
-- 数据分析 Agent
(
    'agent-1111-1111-1111-333333333333',
    '11111111-1111-1111-1111-111111111111',
    'Data Analyst',
    '数据分析专家，擅长数据处理、统计分析和可视化',
    '你是一个数据分析专家。你的任务是帮助用户处理和分析数据。

## 核心能力
- 数据清洗和预处理
- 统计分析和假设检验
- 数据可视化
- 机器学习模型构建

## 工作流程
1. 理解用户的分析需求
2. 检查和清洗数据
3. 进行探索性数据分析
4. 生成可视化图表
5. 提供数据洞察和建议',
    '{
        "model": "gpt-4o",
        "temperature": 0.5,
        "max_tokens": 4096,
        "timeout_seconds": 120,
        "retry_attempts": 3
    }',
    ARRAY['skill-0001-0001-0001-000000000002', 'skill-1111-1111-1111-111111111111'],
    ARRAY[]::TEXT[],
    1,
    false
),
-- 研究助手 Agent（包含子 Agent）
(
    'agent-1111-1111-1111-444444444444',
    '11111111-1111-1111-1111-111111111111',
    'Research Assistant',
    '研究助手，可以协调多个子 Agent 完成复杂研究任务',
    '你是一个高级研究助手，可以协调多个专业助手完成复杂的研究任务。

## 协调能力
- 分解复杂任务为子任务
- 分配任务给合适的专业助手
- 整合各助手的结果
- 生成综合研究报告

## 可用的专业助手
- 通用助手：搜索和基础问答
- 代码助手：技术实现和代码分析
- 数据分析师：数据处理和统计分析

## 工作原则
- 先规划再执行
- 合理分配任务
- 验证和整合结果
- 确保输出质量',
    '{
        "model": "gpt-4o",
        "temperature": 0.7,
        "max_tokens": 8192,
        "timeout_seconds": 300,
        "retry_attempts": 3
    }',
    ARRAY['skill-0001-0001-0001-000000000001', 'skill-1111-1111-1111-222222222222'],
    ARRAY['agent-1111-1111-1111-111111111111', 'agent-1111-1111-1111-222222222222', 'agent-1111-1111-1111-333333333333'],
    1,
    false
),
-- Demo 组织的简单 Agent
(
    'agent-3333-3333-3333-111111111111',
    '33333333-3333-3333-3333-333333333333',
    'Demo Bot',
    '演示用的简单聊天机器人',
    '你是一个友好的演示机器人。你的任务是展示 Semibot 平台的基本功能。

保持回复简短友好，适合演示场景。',
    '{
        "model": "gpt-4o-mini",
        "temperature": 0.8,
        "max_tokens": 1024,
        "timeout_seconds": 60,
        "retry_attempts": 2
    }',
    ARRAY[]::TEXT[],
    ARRAY[]::TEXT[],
    1,
    true  -- 公开 Agent，可供演示
);

-- ----------------------------------------------------------------------------
-- 4. 创建 Agent-Skill 关联（使用关联表）
-- ----------------------------------------------------------------------------
INSERT INTO agent_skills (agent_id, skill_id, priority, config_override) VALUES
-- General Assistant
('agent-1111-1111-1111-111111111111', 'skill-0001-0001-0001-000000000001', 10, '{}'),
('agent-1111-1111-1111-111111111111', 'skill-0001-0001-0001-000000000002', 5, '{}'),
-- Code Assistant
('agent-1111-1111-1111-222222222222', 'skill-0001-0001-0001-000000000002', 10, '{"timeout": 60}'),
('agent-1111-1111-1111-222222222222', 'skill-0001-0001-0001-000000000003', 5, '{}'),
-- Data Analyst
('agent-1111-1111-1111-333333333333', 'skill-0001-0001-0001-000000000002', 10, '{}'),
('agent-1111-1111-1111-333333333333', 'skill-1111-1111-1111-111111111111', 10, '{}'),
-- Research Assistant
('agent-1111-1111-1111-444444444444', 'skill-0001-0001-0001-000000000001', 10, '{}'),
('agent-1111-1111-1111-444444444444', 'skill-1111-1111-1111-222222222222', 5, '{}');

-- ----------------------------------------------------------------------------
-- 5. 创建示例会话和消息
-- ----------------------------------------------------------------------------
INSERT INTO sessions (id, org_id, agent_id, user_id, status, title, metadata) VALUES
(
    'session-1111-1111-1111-111111111111',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    '55555555-5555-5555-5555-555555555555',
    'completed',
    '关于 Semibot 功能的咨询',
    '{"source": "web", "client_version": "1.0.0"}'
);

INSERT INTO messages (id, session_id, role, content, tokens_used, latency_ms) VALUES
(
    'msg-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'user',
    '你好，请介绍一下 Semibot 平台的主要功能',
    15,
    NULL
),
(
    'msg-1111-1111-1111-222222222222',
    'session-1111-1111-1111-111111111111',
    'assistant',
    'Semibot 是一个强大的 AI Agent 平台，主要功能包括：

1. **智能对话** - 支持多轮自然语言对话
2. **技能系统** - 可扩展的技能模块，支持网络搜索、代码执行等
3. **多 Agent 协作** - 支持多个 Agent 协同工作完成复杂任务
4. **记忆系统** - 长期记忆存储，支持上下文理解
5. **API 集成** - 完整的 REST API，便于系统集成

如果您想了解某个具体功能，请告诉我！',
    180,
    1250
);

-- ----------------------------------------------------------------------------
-- 6. 创建示例记忆集合
-- ----------------------------------------------------------------------------
INSERT INTO memory_collections (id, org_id, agent_id, name, description, embedding_model) VALUES
(
    'collection-1111-1111-1111-111111111111',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'General Knowledge',
    '通用知识库，存储常用信息和用户偏好',
    'text-embedding-ada-002'
),
(
    'collection-1111-1111-1111-222222222222',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-222222222222',
    'Code Snippets',
    '代码片段库，存储常用代码模板',
    'text-embedding-ada-002'
);

-- ----------------------------------------------------------------------------
-- 7. 验证数据
-- ----------------------------------------------------------------------------
-- 可通过以下查询验证数据插入是否成功：
-- SELECT * FROM skills WHERE is_builtin = true;
-- SELECT * FROM agents;
-- SELECT * FROM agent_skills;
-- SELECT * FROM sessions;
-- SELECT * FROM messages;
-- SELECT * FROM memory_collections;
