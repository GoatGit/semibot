-- ============================================================================
-- 006_sample_usage_and_logs.sql
-- 开发环境使用量记录和执行日志种子数据
-- ============================================================================

-- 注意：此脚本仅用于开发环境，切勿在生产环境执行

-- ============================================================================
-- 1. 使用量记录 - 日级别
-- ============================================================================
INSERT INTO usage_records (id, org_id, user_id, agent_id, period_start, period_end, period_type, tokens_input, tokens_output, api_calls, tool_calls, sessions_count, messages_count, errors_count, cost_usd) VALUES
-- 组织级汇总
(
    'usage-0001-0001-0001-000000000001',
    '11111111-1111-1111-1111-111111111111',
    NULL,
    NULL,
    '2026-02-01 00:00:00+00',
    '2026-02-01 23:59:59+00',
    'daily',
    50000,
    25000,
    150,
    80,
    30,
    180,
    2,
    0.25
),
(
    'usage-0001-0001-0001-000000000002',
    '11111111-1111-1111-1111-111111111111',
    NULL,
    NULL,
    '2026-02-02 00:00:00+00',
    '2026-02-02 23:59:59+00',
    'daily',
    75000,
    35000,
    220,
    120,
    45,
    280,
    5,
    0.38
),
-- 用户级汇总
(
    'usage-0001-0001-0001-000000000010',
    '11111111-1111-1111-1111-111111111111',
    '55555555-5555-5555-5555-555555555555',
    NULL,
    '2026-02-01 00:00:00+00',
    '2026-02-01 23:59:59+00',
    'daily',
    30000,
    15000,
    80,
    40,
    15,
    100,
    1,
    0.15
),
-- Agent 级汇总
(
    'usage-0001-0001-0001-000000000020',
    '11111111-1111-1111-1111-111111111111',
    NULL,
    'agent-1111-1111-1111-111111111111',
    '2026-02-01 00:00:00+00',
    '2026-02-01 23:59:59+00',
    'daily',
    20000,
    10000,
    60,
    30,
    12,
    75,
    0,
    0.10
)
ON CONFLICT DO NOTHING;

-- ============================================================================
-- 2. 执行日志示例
-- ============================================================================
INSERT INTO execution_logs (id, org_id, agent_id, session_id, request_id, step_id, state, action_type, action_name, action_input, action_output, duration_ms, tokens_input, tokens_output, model) VALUES
(
    'log-0001-0001-0001-000000000001',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'req-abc123',
    'step-1',
    'START',
    'llm_call',
    'gpt-4o',
    '{"messages": [{"role": "user", "content": "你好"}]}',
    NULL,
    150,
    10,
    0,
    'gpt-4o'
),
(
    'log-0001-0001-0001-000000000002',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'req-abc123',
    'step-1',
    'PLAN',
    'llm_call',
    'gpt-4o',
    NULL,
    '{"plan": "回答用户问候"}',
    1200,
    10,
    50,
    'gpt-4o'
),
(
    'log-0001-0001-0001-000000000003',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'req-abc123',
    'step-1',
    'RESPOND',
    'llm_call',
    'gpt-4o',
    NULL,
    '{"response": "你好！有什么可以帮助你的吗？"}',
    800,
    60,
    30,
    'gpt-4o'
),
-- 工具调用日志
(
    'log-0001-0001-0001-000000000010',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'req-def456',
    'step-2',
    'ACT',
    'tool_call',
    'web_search',
    '{"query": "最新科技新闻"}',
    '{"results": [{"title": "AI 突破", "url": "..."}]}',
    2500,
    0,
    0,
    NULL
),
-- 错误日志
(
    'log-0001-0001-0001-000000000020',
    '11111111-1111-1111-1111-111111111111',
    'agent-1111-1111-1111-111111111111',
    'session-1111-1111-1111-111111111111',
    'req-err789',
    'step-3',
    'ACT',
    'tool_call',
    'http_request',
    '{"url": "https://api.example.com/data"}',
    NULL,
    5000,
    0,
    0,
    NULL
)
ON CONFLICT DO NOTHING;

-- 添加错误信息
UPDATE execution_logs
SET error_code = 'TIMEOUT', error_message = '请求超时：5000ms'
WHERE id = 'log-0001-0001-0001-000000000020';

-- ============================================================================
-- 3. 验证数据
-- ============================================================================
-- SELECT * FROM usage_records;
-- SELECT * FROM execution_logs ORDER BY created_at;
